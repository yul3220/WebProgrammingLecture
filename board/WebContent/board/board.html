<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
<script src="../js/jquery.serializejson.min.js"></script>
<script src="../js/board.js"></script>
<style>
    body{
    	margin: 10px;
    }
    p{
        box-sizing: border-box;
    }
    .p1{
        width: 80%;
        float: left;
    }
    .p2{
        width: 20%;
        float : right;
    }
    .p3{
        clear: both;
    }
    button[name=reply]{
        height: 45px;
        vertical-align: top;
    }
    .panel-heading:hover{
        background: #c0fdff
    }
    .pager{
    	width : 140px;
    	float: left;
    	margin: 5px;
    }
    .pul{
    	margin-left : 20%;
    }
    label{
    	display : inline-block;
    	width : 100px;
    	height : 20px;
    }
</style>
<script>
	$(function(){
		//readServer();
		readPageServer(1);
		
		// 페이지번호, 이전, 다음 버튼 클릭에 대한 이벤트
		$("#pagelist").on("click",".paging", function(){
			currentPage = $(this).text();//class active => 파란색 값이 바뀌는것
			//readPageServer($(this).text());
			readPageServer(currentPage);
			//숫자를 나타내는 곳은 for문을 돌고있는 상태
		})
		
		// 다음 버튼 클릭
		$("#pagelist").on("click", ".next", function(){
			currentPage = parseInt($(".paging").last().text())+1;//문자이기때문에 형변환후 더하기
			readPageServer(currentPage);
		})
		
		// 이전 버튼 클릭
		$("#pagelist").on("click", ".prev", function(){
			currentPage = parseInt($(".paging").first().text())-1;
			readPageServer(currentPage);
		})
		
		// 각 버튼에 대한 이벤트, 리스트 제목줄 클릭이벤트
		$(".box").on("click", ".action", function(){
			vname = $(this).attr("name");
			vidx = $(this).attr("idx");
			
			if(vname == "modify"){
				//alert(vidx+"번글을 수정합니다.");
				//data-toggle="modal" data-target="#modiModal" => board.js에 있는 버튼에 작성해도 됨
				// 모달창 띄우기
				$("#modiModal").modal("show");
				
				// 모달창에 수정할 내용을 출력
				parent = $(this).parents('.panel');
	            title  = $(parent).find('a').text();
	            writer = $(parent).find('.wr').text();
	            mail   = $(parent).find('.wm').text();
	            cont   = $(parent).find('.wc').html();
	            num    = vidx;
	            
	            cont = cont.replace(/<br>/g, "\n");
	            
	            $('#mform #subject').val(title);
	            $('#mform #writer').val(writer);
	            $('#mform #mail').val(mail);
				$('#mform #num').val(num);
	            $('#mform #content').val(cont);
	            
			}else if(vname=="delete"){
				//alert(vidx+"번글을 삭제합니다.");
				deleteBoard(this);
			}else if(vname=="reply"){
				alert(vidx+"번글을 댓글을 답니다.");
			}else if(vname=="list"){
				//alert(vidx+"번글의 조회수 증가와 댓글목록");
				vclass = $(this).parents(".panel").find(".in").attr("class");
				console.log(vclass);
				
				// vclass가 undefined일때 조회수증가
				//panel-collapse collapse in=> 창닫힌거
				//누른다음에 출력되기 때문에
				// undefined는 값이 정해지지 않은 자료형 - 비교시 typeof를 사용
				if(typeof vclass == "undefined"){
					// 조회수 증가
					readHitServer(this);
				}
			}
		})
		
		// 글쓰기 전송버튼 
		$("#wsend").on("click", function(){
			insertBoard();
			
			//비동기이기때문에 함수가 실행되고 진행될지 실행되지 않고 실행되지 모른다.
			//성공할때 진행되게 하기 위해서 js의 insertBoard의 success부분에 코드 작성
			//$("#writeModal").modal("hide");
			//$(".txt").val("");
			//content의 내용의 엔터를 사용하면 후에 200번의 에러가 남
			//가져올때는 엔터 부분을 <br>로 바꾸어주어야함
			//readPageServer(1); => 동기(요청과 응답이 1:1)
		})
		
		// 수정 전송버튼
		$("#msend").on("click", function(){
			updateBoard();
			// updateBoard()함수에서 수정 버튼이 필요하다.
			// 수정버튼 이용하여 조상(.panel)을 검색하여 
			// parent 변수에 저장
			// parent는 전역변수다.
		})
	});//function끝
</script>
</head>
<body>
   <h2>게시판</h2>
   <br>
   <br>
   <button class="btn btn-success" data-toggle="modal" data-target="#writeModal" type="button">글쓰기</button>
   <br><br>
   
   
   <div class="box">
   </div>
   <br><br>
   <div id="pagelist"></div>
   <!-- Modal -->
<div id="writeModal" class="modal fade" role="dialog">
  <div class="modal-dialog">

    <!-- Modal content-->
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal">&times;</button>
        <h4 class="modal-title">게시판 글 작성</h4>
      </div>
      <div class="modal-body">
        <form id="wform">
           <label>제목</label>
           <input class ="txt" name="subject"/><br><!-- input type을 생략하면 자동적으로 text이다. -->
           <label>작성자</label>
           <input class ="txt" name="writer"/><br>
           <label>메일</label>
           <input class ="txt" name="mail"/><br>
           <label>비밀번호</label>
           <input class ="txt" type="password" name="password"/><br>
           <label>내용</label><br>
           <textarea class ="txt" rows="10" cols="50" name="content"></textarea>
           <br>
           <button class="btn btn-primary" id="wsend" type="button">전송</button>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
      </div>
    </div>

  </div>
</div>

 <!-- Modal -->
<div id="modiModal" class="modal fade" role="dialog">
  <div class="modal-dialog">

    <!-- Modal content-->
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal">&times;</button>
        <h4 class="modal-title">게시판 글 수정</h4>
      </div>
      <div class="modal-body">
        <form id="mform">
           <input type="hidden" id="num" name="num">
           <!--hidden을 통해 게시판의 번호는 숨기고있지만 where절에서 중요한 역할
           / 비밀번호가져오고싶으면 hidden을 통해서 가져와야 함
           /name속성 VO나 DB와 일치해야 한다.-->
           <label>제목</label>
           <input class ="txt" id="subject" name="subject"/><br>
           <label>작성자</label>
           <input class ="txt" id="writer" name="writer"/><br>
           <label>메일</label>
           <input class ="txt" id="mail" name="mail"/><br>
           <label>비밀번호</label>
           <input class ="txt" type="password" id="password" name="password"/><br>
           <label>내용</label><br>
           <textarea class ="txt" rows="10" cols="50" id="content" name="content"></textarea>
           <br>
           <button class="btn btn-primary" id="msend" type="button">전송</button>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
      </div>
    </div>

  </div>
</div>
</body>
</html>